Description: fix denial of service and possible code execution via
 JPEG EXIF integer overflow.
Origin: upstream, http://trac.imagemagick.org/changeset/7321/ImageMagick/branches/ImageMagick-6/magick/property.c
Origin: upstream, http://trac.imagemagick.org/changeset/7322
Origin: upstream, http://trac.imagemagick.org/changeset/7323

Index: imagemagick-6.6.9.7/magick/profile.c
===================================================================
--- imagemagick-6.6.9.7.orig/magick/profile.c	2012-04-25 10:21:41.830197165 -0400
+++ imagemagick-6.6.9.7/magick/profile.c	2012-04-25 10:22:27.170198326 -0400
@@ -1932,8 +1932,10 @@
       format=(ssize_t) ReadProfileShort(endian,q+2);
       if ((format-1) >= EXIF_NUM_FORMATS)
         break;
-      components=(int) ReadProfileLong(endian,q+4);
+      components=(ssize_t) ((int) ReadProfileLong(endian,q+4));
       number_bytes=(size_t) components*format_bytes[format];
+      if (number_bytes < components)
+        break;  /* prevent overflow */
       if (number_bytes <= 4)
         p=q+8;
       else
Index: imagemagick-6.6.9.7/magick/property.c
===================================================================
--- imagemagick-6.6.9.7.orig/magick/property.c	2012-04-25 10:21:41.854197167 -0400
+++ imagemagick-6.6.9.7/magick/property.c	2012-04-25 10:22:36.422198566 -0400
@@ -1302,6 +1302,8 @@
         break;
       components=(ssize_t) ((int) ReadPropertyLong(endian,q+4));
       number_bytes=(size_t) components*tag_bytes[format];
+      if (number_bytes < components)
+        break;  /* prevent overflow */
       if (number_bytes <= 4)
         p=q+8;
       else
