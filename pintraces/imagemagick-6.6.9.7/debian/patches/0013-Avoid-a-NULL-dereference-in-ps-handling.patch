Backport of:

From f093a3119704fd6d349a9ee32b9f71cabe7d04c8 Mon Sep 17 00:00:00 2001
From: cristy <cristy@aa41f4f7-0bf4-0310-aa73-e5a19afd5a74>
Date: Fri, 28 Nov 2014 17:13:45 +0000
Subject: [PATCH] Avoid a NULL dereference in ps handling

GetStringInfoDatum(NULL) will likely crash. Avoid it.

git-svn-id: https://subversion.imagemagick.org/subversion/ImageMagick/branches/ImageMagick-6@17117 aa41f4f7-0bf4-0310-aa73-e5a19afd5a74
origin: http://trac.imagemagick.org/changeset/17117
---
 coders/ps.c | 13 ++++++++-----
 1 file changed, 8 insertions(+), 5 deletions(-)

Index: imagemagick-6.6.9.7/coders/ps.c
===================================================================
--- imagemagick-6.6.9.7.orig/coders/ps.c	2016-11-14 14:15:43.129857008 -0500
+++ imagemagick-6.6.9.7/coders/ps.c	2016-11-14 14:16:56.349860422 -0500
@@ -556,11 +556,14 @@
           continue;
         length=extent;
         profile=AcquireStringInfo(length);
-        p=GetStringInfoDatum(profile);
-        for (i=0; i < (ssize_t) length; i++)
-          *p++=(unsigned char) ProfileInteger(image,hex_digits);
-        (void) SetImageProfile(image,"8bim",profile);
-        profile=DestroyStringInfo(profile);
+        if (profile != (StringInfo *) NULL)
+          {
+            p=GetStringInfoDatum(profile);
+            for (i=0; i < (ssize_t) length; i++)
+              *p++=(unsigned char) ProfileInteger(image,hex_digits);
+            (void) SetImageProfile(image,"8bim",profile);
+            profile=DestroyStringInfo(profile);
+          }
         continue;
       }
     if (LocaleNCompare(BeginXMPPacket,command,strlen(BeginXMPPacket)) == 0)
